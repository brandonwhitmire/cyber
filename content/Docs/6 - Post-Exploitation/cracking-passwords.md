+++
title = "Cracking Passwords"
+++

- https://openwall.info/wiki/john/sample-hashes
- https://pentestmonkey.net/cheat-sheet/john-the-ripper-hash-formats
- https://hashes.com/en/tools/hash_identifier

```bash
# Give JtR and hashcat --format code
hashid -jm '<HASH>'

# Create wordlist from website
# e.g. make all words lowercase, spider down the website X, and choose only word certain legth Y or more
cewl --lowercase -d <SPIDER_DEPTH> -m <MIN_WORD_LENGTH>  -w <WORDLIST_FILENAME>
```

### Username Generation

```bash
# GOOGLE DORK: Find emails and user name scheme
site:<DOMAIN> "@<DOMAIN>"

# Generate different common permutations of usernames
git clone https://github.com/urbanadventurer/username-anarchy && cd username-anarchy
./username-anarchy -i <USERNAMES>
```

### in Files

```bash
# Find all JtR Utilities
sudo updatedb && locate '*2john' | grep -v 'pycache'

# Zip
zip2john <ZIP_FILE> > hash_zip.txt

# RAR
rar2john <RAR_FILE> > hash_rar.txt

# Office docs
office2john <OFFICE_FILE> > hash_office.txt

# PDF
pdf2john <PDF_FILE> > hash_pdf.txt

# Bitlocker
bitlocker2john -i <VHD_FILE> > pre_hash_vhd.txt
grep "bitlocker\$0" pre_hash_vhd.txt > hash_crackme_vhd.txt
hashcat -a 0 -m 22100 hash_crackme_vhd.txt <WORDLIST>

# Mount w/ Bitlocker
sudo apt install -y dislocker
sudo mkdir -p /media/{bitlocker,bitlockermount}
sudo losetup -f -P Backup.vhd
ls -la /dev/loop*
sudo dislocker /dev/<LOOP_DEV> -u<PASSWORD> -- /media/bitlocker
sudo mount -o loop /media/bitlocker/dislocker-file /media/bitlockermount

# SSH: find Private Keys
grep -rnE '^\-{5}BEGIN [A-Z0-9]+ PRIVATE KEY\-{5}$' /* 2>/dev/null
# See if private key is password protected
ssh-keygen -yf <PRIVKEY>
# Get hash of key
ssh2john <PRIVKEY> > ssh.hash

# OpenSSL
while read p; do
    openssl enc -aes-256-cbc -d -in <ENC_FILE> -k "$p" 2>/dev/null | tar xz 2>/dev/null
    if [ $? -eq 0 ]; then
        echo "Success! Password is: $p"
        break
    fi
done < <WORDLIST>
```

### Common Hash Values

| Hash Value | Type | Meaning |
| :--- | :--- | :--- |
| **`d41d8cd98f00b204e9800998ecf8427e`** | **MD5** | **Empty String** (0 byte input) |
| **`da39a3ee5e6b4b0d3255bfef95601890afd80709`** | **SHA1** | **Empty String** (0 byte input) |
| **`e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855`** | **SHA256** | **Empty String** (0 byte input) |

### Create Custom Permutated Wordlist

- https://hashcat.net/wiki/doku.php?id=rule_based_attack

```bash
# Manually generate keywords or use cewl via OSINT
cat << EOF > keywords.txt
<KEYWORDS>
EOF

# c - Capitalize the first character, lowercase the rest
# C - Lowercase the first character, uppercase the rest
# t - Toggle the case of all characters in a word
# $! - Appends the character ! to the end 
# $1$9$9$8 - Appends '1998' to the end
# $1$9$9$8$! - Appends '1998!' to the end
# sa@ - Replace all instances of a with @
# so0 - Replace all instances of o with 0
# ss$ - Replace all instances of s with $
cat << EOF > custom.rule
c
C
t                                                                \$!
\$1\$9\$9\$8
\$1\$9\$9\$8\$!
sa@
so0
ss\$
EOF

# Generate permutated wordlist
hashcat --force -r custom.rule keywords.txt  --stdout | sort -u > wordlist.txt

# Crack hash
hashcat -a 0 -m <HASH_ID> -r custom.rule <HASH> wordlist.txt
```

### ðŸ”¨  John the Ripper

- https://www.openwall.com/john/doc/OPTIONS.shtml

```bash
# John attempts to guess the hash type, but specifiying the FORMAT is recommended
john --list=formats

# john --format=NT
# john --format=raw-md5
# john --format=sha512crypt
john --format=<FORMAT> --wordlist=<WORDLIST> <HASH_FILE>

# Single crack mode: makes permutations given a username
unshadow passwd.txt shadow.txt > unshadowed.txt
john --single <UNSHADOW_FILE>

# Dynamically generated wordlist using Markov chains
john --incremental <HASH_FILE>
```

### ðŸ”¨  Hashcat

- https://hashcat.net/wiki/doku.php?id=example_hashes
- `/usr/share/hashcat/rules`
- https://pentesting.site/cheat-sheets/hashcat/

### Rule Comparison Table

| Rule File | Rule Count | Use Case |
| :--- | :--- | :--- |
| **`best64.rule`** | 64 | **First Run.** Instant results for easy passwords. |
| **`d3ad0ne.rule`** | ~34,000 | **Deep Crack.** Good for standard "complex" user passwords. |
| **`dive.rule`** | ~100,000+ | **Paranoid.** extremely slow; last resort for dictionary attacks. |

```bash
# Crack an MD5crypt hash with a salt using Hashcat
hashcat -m 20 <HASH>:<SALT> <WORDLIST>

# Crack a SHA512crypt hash using Hashcat
hashcat -m 1800 hashes.txt <WORDLIST>
# 64 standard password modifications like: appending nums or substituting characters with their "leet" equivalents 
hashcat -m 1800 -r /usr/share/hashcat/rules/best64.rule hashes.txt <WORDLIST>
```

#### Mask attack (`-a 3`) with Charsets

| Symbol   | Description | Charset / Definition                |
| :------- | :---------- | :---------------------------------- |
| **`?l`** | Lowercase   | `abcdefghijklmnopqrstuvwxyz`        |
| **`?u`** | Uppercase   | `ABCDEFGHIJKLMNOPQRSTUVWXYZ`        |
| **`?d`** | Digits      | `0123456789`                        |
| **`?h`** | Hex (Lower) | `0123456789abcdef`                  |
| **`?H`** | Hex (Upper) | `0123456789ABCDEF`                  |
| **`?s`** | Special     | Â«spaceÂ»!"#$%&'()*+,-./:;<=>?@[]^_{` |
| **`?a`** | All         | `?l?u?d?s`                          |
| **`?b`** | Binary      | `0x00 - 0xff`                       |

```bash
hashcat -a 3 -m <HASH_ID> <HASH> '?u?l?l?l?l?d?s'
```
